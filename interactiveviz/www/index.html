<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>
        No Arena in Chinatown
    </title>
    <link 
        rel="stylesheet" 
        href="https://cdn.jsdelivr.net/npm/bulma@1.0.2/css/bulma.min.css"
    />
    <link rel="stylesheet" href="custom.css"/>
    <link
        rel="stylesheet"
        href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <style type="text/css">
        /* add styles here */
    </style>
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>


  </head>
  <body>
  <section class="section">
    <div class="container">
        <h1 class="title">
            "No Arena in Chinatown": Learning from a Lost Community
        </h1>
        <div id="intro">
            <p class="block">
                Philadelphia city officials are currently considering a proposal for a $1.3 billion basketball 
                arena for the Philadelphia 76ers to be built on the edge of the Chinatown neighborhood. 
                While the developers and city officials promise economic growth for the area, 
                Chinatown residents and many others in Philadelphia believe that the arena 
                will only serve the billionare investors and developers while destroying the vibrant 
                Chinatown community. Activists have successfully fended off large corporate development projects 
                around Chinatown in the past, including a baseball stadium, and are once again working to 
                stop the construction of the 76ers arena. They assert that there is little evidence to support 
                positive growth for the Chinatown community or Philadelphia as a 
                whole (the arena owners will not be paying any property taxes). 
            </p>  
            <p class="block">
                Activists point to Washington DC's Chinatown, a once vibrant neighborhood full of small 
                businesses and Asian immigrants that saw a rapid downturn following similar development projects. 
                After the construction of a convention center in the 1980s and Capital One Arena in the Chinatown area in 1997, 
                residents were rapidly displaced, priced out of their homes or evicted, and the proportion of 
                Asian people able to live in the area dwindled. Small local businesses could not longer operate and were 
                replaced by large national corporations. 
            </p>
            <h3 class="subtitle">
                Use the slider to see changes in the demographics of Washington DC's and 
                Philadelphia's Chinatowns since 1980.  
                <!-- Click the "Build Arena" button to simulate what it would look
                like if Philadelphia's Chinatown neighborhood changes at the same rate
                as DC's following the construction of the Capital One Arena in 1997. -->
            </h3> 
            <!-- <button type="button">Build Arena</button> -->
            <label for="dropdown">Select a variable:</label>
            <select name="variable" id="dropdown">
              <option value="PROP_AAPI">AAPI Population Proportion</option>
              <option value="MED_INCOME_ADJ">Median Household Income</option>
              <option value="PROP_DEGREE">College Degree Proportion</option>
            </select>
            <input type="range" min="1980" max="2020" value="1980" step="10"
            class="slider" id="yearSlider">
            <datalist id="slider-labels">
                <option value="1980" label="1980"></option>
                <option value="1990" label="1990"></option>
                <option value="2000" label="2000"></option>
                <option value="2010" label="2010"></option>
                <option value="2020" label="2020"></option>
            </datalist>          
        </div>    
    </div>
    <div class="container">
        <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
        <script src = "data.js"></script>
        <div class="columns">
            <div class="column">
                <div class="box">
                    <h2 class = "title">
                        Washington DC Chinatown Demographics 1980-2020
                    </h2>
                    <div id="DCmap">
                    </div>
                    <script>
                        const dcChinatown = [38.8972, -77.01215];
                        const initialZoomDC = 15;
                        const DCmap = L.map("DCmap").setView(dcChinatown, initialZoomDC)
                        L.tileLayer("https://api.maptiler.com/maps/basic-v2/{z}/{x}/{y}.png?key=GIc3utYGXWyTspaRbTFz", {
                            maxZoom: 19,
                            attribution: "\u003ca href=\"https://www.maptiler.com/copyright/\" target=\"_blank\"\u003e\u0026copy; MapTiler\u003c/a\u003e \u003ca href=\"https://www.openstreetmap.org/copyright\" target=\"_blank\"\u003e\u0026copy; OpenStreetMap contributors\u003c/a\u003e",
                            }).addTo(DCmap);
                        dcCTBound = L.geoJson(dcChinatownBoundary).addTo(DCmap);
                        dcCTBound.setStyle({
                            color: "#4A7CB1"
                        });
                        var capitalOneArenaMarker = L.marker([38.8982, -77.020986]).addTo(DCmap);
                        capitalOneArenaMarker.bindPopup("<b>Capital One Arena</b><br>Built in 1997").openPopup();
                    </script>

                </div>
                <div class="box">
                    <h2 class = "title">
                        add chart
                    </h2>
                </div>
            </div>
            <div class="column">
                <div class="box">
                    <h2 class = "title">
                        Philadelphia Chinatown Demographics 1980-2020
                    </h2>
                    <div id="phlmap">
                    </div>
                    <script>
                        const phlChinatown = [39.95562, -75.15780];
                        const initialZoomPhl = 15;
                        const phlmap = L.map("phlmap").setView(phlChinatown, initialZoomPhl)
                        L.tileLayer("https://api.maptiler.com/maps/basic-v2/{z}/{x}/{y}.png?key=GIc3utYGXWyTspaRbTFz", {
                            maxZoom: 19,
                            attribution: "\u003ca href=\"https://www.maptiler.com/copyright/\" target=\"_blank\"\u003e\u0026copy; MapTiler\u003c/a\u003e \u003ca href=\"https://www.openstreetmap.org/copyright\" target=\"_blank\"\u003e\u0026copy; OpenStreetMap contributors\u003c/a\u003e",
                            }).addTo(phlmap);
                        phlCTBound = L.geoJson(phlChinatownBoundary).addTo(phlmap);
                        phlCTBound.setStyle({
                            color: "#4A7CB1"
                        })
                        var proposedArena = L.marker([39.952159, -75.157449]).addTo(phlmap);
                        proposedArena.bindPopup("<b>Site of proposed 76ers arena</b><br>To be built by 2031").openPopup();
                    </script>
                </div>
                <div class="box">
                    <h2 class = "title">
                        add chart
                    </h2>
                    <div id="dcBar"></div>
                        <script>
                            // let div = d3
                            //     .select("#dcBar")
                            //     .append("svg")
                            //     .attr("width", 200)
                            //     .attr("height", 200)
                            //     .attr("viewBox", "0 0 200 200");

                            // const margin = 25
                            // const height = 200 - margin
                            // const width = 200 - margin
                            // const barWidth = 25
                            // const barPadding = 3

                            // const visitorsScale = d3
                            // .scaleLinear()
                            // .domain([0,18000000])
                            // .range([height * 0.5, 0])
                            // .clamp(true);

                        </script>
                </div>
            </div>
        </div>
        <div class="slidecontainer">
            <script>
                function getColorPop(p) {
                    return p >= 0.8 ? "#800026":
                        p > 0.7 ? "#bd0026":
                        p > 0.6 ? "#e31a1c":
                        p > 0.5 ? "#fc4e2a":
                        p > 0.4 ? "#fd8d3c":
                        p > 0.3 ? "#feb24c":
                        p > 0.2 ? "#fed976":
                        p > 0.1 ? "#ffeda0":
                                    "#ffffcc" ;
                };
                function popStyle (feature) {
                    return {
                        fillColor: getColorPop(feature.properties.PROP_AAPI),
                        fillOpacity: 0.8,
                        weight: 3,
                        opacity: 1,
                        color: "#FFFAE3",
                        dashArray: "3"
                    };
                }; 
                var geojsonDC;
                var geojsonPhl;
                function highlightFeatureDC(e) {
                    var layer = e.target;
                    layer.setStyle({
                        weight: 5,
                        color: "#4D2C00",
                        dashArray: '',
                        fillOpacity: 0.7
                    });
                    infoDC.update(layer.feature.properties);
                    dcCTBound.bringToFront();
                }

                function highlightFeaturePhl(e) {
                    var layer = e.target;
                    layer.setStyle({
                        weight: 5,
                        color: "#4D2C00",
                        dashArray: '',
                        fillOpacity: 0.7
                    });
                    infoPhl.update(layer.feature.properties);
                    phlCTBound.bringToFront()
                }

                function resetHighlightDC(e) {
                    geojsonDC.resetStyle(e.target);
                    infoDC.update();;
                }

                function resetHighlightPhl(e) {
                    geojsonPhl.resetStyle(e.target);
                    infoPhl.update();
                }

                function onEachFeatureDC(feature, layer) {
                    layer.on({
                        mouseover: highlightFeatureDC,
                        mouseout: resetHighlightDC,
                    });
                };

                function onEachFeaturePhl(feature, layer) {
                    layer.on({
                        mouseover: highlightFeaturePhl,
                        mouseout: resetHighlightPhl,
                    });
                };

                var infoDC = L.control();
                infoDC.onAdd = function (map) {
                    this._div = L.DomUtil.create('div', 'info'); 
                    this.update();
                    return this._div;
                };
                infoDC.update = function (props) {
                    this._div.innerHTML = '<h4>AAPI Population</h4>' + (props ?
                                props.PROP_AAPI * 100 + "% of pop." : "Hover on Tract");
                };

                var infoPhl = L.control();
                infoPhl.onAdd = function (map) {
                    this._div = L.DomUtil.create('div', 'info'); 
                    this.update();
                    return this._div;
                };
                infoPhl.update = function (props) {
                    this._div.innerHTML = '<h4>AAPI Population</h4>' + (props ?
                                props.PROP_AAPI * 100 + "% of pop." : "Hover on Tract");
                };

                let allYears = {
                    "1980": data1980,
                    "1990": data1990,
                    "2000": data2000,
                    "2010": data2010,
                    "2020": data2020
                };

                var legendDC = L.control({position: 'bottomright'});
                legendDC.onAdd = function (map) {
                    var div = L.DomUtil.create('div', 'info legend'),
                        grades= [0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8],
                        labels = [];
                    for (var i = 0; i < grades.length; i++) {
                        div.innerHTML +=
                            '<i style="background:' + getColorPop(grades[i]) + '"></i> ' +
                            grades[i] * 100 + (grades[i + 1] * 100 ? '&ndash;' + grades[i + 1] * 100 +"%" + '<br>' : '+');
                    }
                    return div;
                };
                legendDC.addTo(DCmap);

                var legendPhl = L.control({position: 'bottomright'});
                legendPhl.onAdd = function (map) {
                    var div = L.DomUtil.create('div', 'legend'),
                    grades= [0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8],
                        labels = [];
                    for (var i = 0; i < grades.length; i++) {
                        div.innerHTML +=
                            '<i style="background:' + getColorPop(grades[i]) + '"></i> ' +
                            grades[i] * 100 + (grades[i + 1] * 100 ? '&ndash;' + grades[i + 1] * 100 +"%" + '<br>' : '+');
                    }
                    return div;
                };
                legendPhl.addTo(phlmap);

                var slider = document.getElementById("yearSlider");
                geojsonDC = L.geoJson(data1980, {style: popStyle, 
                    onEachFeature: onEachFeatureDC}).addTo(DCmap)
                geojsonPhl = L.geoJson(data1980, {style: popStyle,
                    onEachFeature: onEachFeaturePhl
                }).addTo(phlmap)
                infoDC.addTo(DCmap);
                infoPhl.addTo(phlmap);
                slider.oninput = function() {
                    DCmap.removeLayer(geojsonDC);
                    phlmap.removeLayer(geojsonPhl);
                    year = this.value
                    geojsonDC = L.geoJson(allYears[year], {style: popStyle,
                        onEachFeature: onEachFeatureDC
                    }).addTo(DCmap);
                    geojsonPhl = L.geoJson(allYears[year], {style: popStyle,
                        onEachFeature: onEachFeaturePhl
                    }).addTo(phlmap);
                    dcCTBound.bringToFront();
                    phlCTBound.bringToFront();
                };
                dcCTBound.bringToFront();
                phlCTBound.bringToFront();
            </script>
        </div>
    </div>
    <div class="container">
    </div>
  </section>

  <!-- <script src="utils.js"></script>
  <script src="barchart.js"></script> -->
  
  </body>
</html>